<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Байес одним свайпом</title>
  <!-- Tailwind по CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 по CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel для JSX в браузере -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-white">
  <div id="root"></div>

  <script type="text/babel">
    const {useState, useMemo} = React;

    function clamp01(x){ return Math.max(0, Math.min(1, x)); }
    function pct(x){ return !isFinite(x) ? "—" : (100*x).toFixed(1)+"%"; }
    function fmt(x){
      if (!isFinite(x)) return "—";
      if (x >= 1000 || x <= 0.001) return x.toExponential(2);
      return x.toFixed(3);
    }

    function BayesOneSwipe(){
      const [mode, setMode] = useState("oneswipe"); // "oneswipe" | "advanced"
      const [priorPct, setPriorPct] = useState(70);
      const [log10LR, setLog10LR] = useState(0);
      const [pAgivenB, setPAgivenB] = useState(0.10);
      const [pAgivenNotB, setPAgivenNotB] = useState(0.80);

      const prior = clamp01(priorPct/100);
      const priorOdds = prior/(1-prior);
      const LR = mode === "oneswipe" ? Math.pow(10, log10LR) : (pAgivenB / pAgivenNotB);
      const posteriorOdds = priorOdds * LR;
      const posterior = posteriorOdds/(1+posteriorOdds);

      const pA = useMemo(()=>{
        if (mode !== "advanced") return null;
        const pNotB = 1 - prior;
        return pAgivenB*prior + pAgivenNotB*pNotB;
      }, [mode, pAgivenB, pAgivenNotB, prior]);

      function loadCoffeeExample(){
        setMode("advanced");
        setPriorPct(70);
        setPAgivenB(0.10);
        setPAgivenNotB(0.80);
      }
      function resetAll(){
        setMode("oneswipe");
        setPriorPct(50);
        setLog10LR(0);
        setPAgivenB(0.5);
        setPAgivenNotB(0.5);
      }

      return (
        <div className="w-full max-w-3xl mx-auto p-6">
          <div className="mb-6">
            <h1 className="text-2xl font-bold">Байес одним свайпом</h1>
            <p className="text-sm text-gray-600 mt-1">
              Мини-калькулятор обновления убеждений: априор + сила доказательства → апостериор.
            </p>
          </div>

          <div className="flex gap-2 mb-4">
            <button onClick={()=>setMode("oneswipe")}
              className={`px-3 py-2 rounded-xl text-sm border ${mode==="oneswipe"?"bg-black text-white":"bg-white text-gray-800"} transition`}>
              One-Swipe (LR)
            </button>
            <button onClick={()=>setMode("advanced")}
              className={`px-3 py-2 rounded-xl text-sm border ${mode==="advanced"?"bg-black text-white":"bg-white text-gray-800"} transition`}>
              Расширенный (P(A|B))
            </button>
            <button onClick={resetAll} className="ml-auto px-3 py-2 rounded-xl text-sm border">Сброс</button>
            <button onClick={loadCoffeeExample} className="px-3 py-2 rounded-xl text-sm border">Пример: «кофе»</button>
          </div>

          <div className="mb-6 p-4 rounded-2xl border">
            <div className="flex items-center justify-between">
              <h2 className="font-semibold">Априорная уверенность, P(B)</h2>
              <div className="text-sm text-gray-700">{pct(prior)}</div>
            </div>
            <input type="range" min={0} max={100} value={priorPct}
              onChange={(e)=>setPriorPct(parseInt(e.target.value))} className="w-full mt-3"/>
            <div className="flex justify-between text-xs text-gray-500 mt-1">
              <span>0%</span><span>50%</span><span>100%</span>
            </div>
          </div>

          {mode==="oneswipe" ? (
            <div className="mb-6 p-4 rounded-2xl border">
              <div className="flex items-center justify-between">
                <h2 className="font-semibold">Сила доказательства (log₁₀ LR)</h2>
                <div className="text-sm text-gray-700">LR = {fmt(LR)} | log₁₀(LR) = {log10LR.toFixed(2)}</div>
              </div>
              <input type="range" min={-3} max={3} step={0.01} value={log10LR}
                onChange={(e)=>setLog10LR(parseFloat(e.target.value))} className="w-full mt-3"/>
              <div className="flex justify-between text-xs text-gray-500 mt-1">
                <span>сильно против</span><span>нейтрально</span><span>сильно за</span>
              </div>
              <div className="grid grid-cols-3 gap-2 mt-3 text-xs">
                {[
                  {label:"слабо против", v:-0.30},
                  {label:"умеренно против", v:-0.70},
                  {label:"сильно против", v:-1.00},
                  {label:"слабо за", v:0.30},
                  {label:"умеренно за", v:0.70},
                  {label:"сильно за", v:1.00},
                ].map((b,i)=>(
                  <button key={i} onClick={()=>setLog10LR(b.v)} className="px-2 py-1 border rounded-xl">{b.label}</button>
                ))}
              </div>
              <p className="text-xs text-gray-500 mt-2">
                Подсказка: LR = P(A|B) / P(A|¬B). log₁₀(LR)=1 → доказательство в 10× вероятнее при B, чем при ¬B.
              </p>
            </div>
          ) : (
            <div className="mb-6 p-4 rounded-2xl border">
              <h2 className="font-semibold">Условные вероятности</h2>
              <div className="mt-2 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <div className="flex items-center justify-between">
                    <label className="text-sm">P(A|B)</label>
                    <span className="text-sm text-gray-700">{pct(pAgivenB)}</span>
                  </div>
                  <input type="range" min={0} max={100} value={Math.round(pAgivenB*100)}
                    onChange={(e)=>setPAgivenB(parseInt(e.target.value)/100)} className="w-full mt-2"/>
                </div>
                <div>
                  <div className="flex items-center justify-between">
                    <label className="text-sm">P(A|¬B)</label>
                    <span className="text-sm text-gray-700">{pct(pAgivenNotB)}</span>
                  </div>
                  <input type="range" min={0} max={100} value={Math.round(pAgivenNotB*100)}
                    onChange={(e)=>setPAgivenNotB(parseInt(e.target.value)/100)} className="w-full mt-2"/>
                </div>
              </div>
              <div className="mt-3 text-sm">LR = P(A|B) / P(A|¬B) = <span className="font-mono">{fmt(LR)}</span></div>
              {pA!==null && (
                <div className="mt-1 text-xs text-gray-600">
                  P(A) = P(A|B)·P(B) + P(A|¬B)·P(¬B) = <span className="font-mono">{fmt(pA)}</span>
                </div>
              )}
            </div>
          )}

          <div className="p-4 rounded-2xl border bg-gray-50">
            <h2 className="font-semibold mb-2">Результат</h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
              <div className="p-3 bg-white rounded-xl border">
                <div className="text-gray-500">Априор</div>
                <div className="text-xl font-semibold">{pct(prior)}</div>
                <div className="text-xs text-gray-500">odds = {fmt(priorOdds)}</div>
              </div>
              <div className="p-3 bg-white rounded-xl border">
                <div className="text-gray-500">Доказательство</div>
                <div className="text-xl font-semibold">LR = {fmt(LR)}</div>
                <div className="text-xs text-gray-500">log₁₀(LR) = {fmt(Math.log10(LR))}</div>
              </div>
              <div className="p-3 bg-white rounded-xl border">
                <div className="text-gray-500">Апостериор</div>
                <div className="text-xl font-semibold">{pct(posterior)}</div>
                <div className="text-xs text-gray-500">odds = {fmt(posteriorOdds)}</div>
              </div>
            </div>
            <div className="mt-3 text-xs text-gray-600">
              prior_odds = P(B)/(1−P(B)); posterior_odds = prior_odds × LR; P(B|A) = posterior_odds/(1+posterior_odds).
            </div>
          </div>

          <div className="mt-6 text-xs text-gray-500">
            <p>«Одним свайпом» — это настройка log₁₀(LR). В «расширенном» режиме задайте P(A|B) и P(A|¬B).</p>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<BayesOneSwipe/>);
  </script>
</body>
</html>
